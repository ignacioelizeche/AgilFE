"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const find_java_home_1 = __importDefault(require("find-java-home"));
const { exec } = require("child_process");
var fs = require("fs");
class XMLDsig {
    constructor() { }
    /**
     * Firma con Java, retornando el documento firmado en el buffer de salida
     * @param xml
     * @param tag
     * @returns
     */
    signDocument(xml, tag, file, passphase) {
        return __awaiter(this, void 0, void 0, function* () {
            return new Promise((resolve, reject) => __awaiter(this, void 0, void 0, function* () {
                find_java_home_1.default({ allowJre: true }, (err, java8Path) => {
                    java8Path += "/bin/java";
                    if (err)
                        return console.log(err);
                    //Comentar esta linea al llevar a Produccion, por que aqui trae java 6
                    if (process.env.java8_home) {
                        //java8Path = `"C:\\Program Files\\Java\\jdk1.8.0_221\\bin\\java"`;
                        java8Path = `${process.env.java8_home}`;
                    }
                    const classPath = "" + __dirname + "";
                    //const tmpXMLToSign = "" + __dirname + "/xml_sign_temp.xml";
                    const tmpXMLToSign = "" +
                        __dirname +
                        "/xml_sign_temp_" +
                        Math.round(Math.random() * 999999) +
                        ".xml";
                    fs.writeFileSync(tmpXMLToSign, xml, { encoding: "utf8" });
                    exec(`"${java8Path}" -Dfile.encoding=IBM850 -classpath "${classPath}" SignXML "${tmpXMLToSign}" "${file}" "${passphase}" "${tag}"`, { encoding: "UTF-8" }, (error, stdout, stderr) => {
                        let entro = 0;
                        if (entro == 0) {
                            //Evita hacer 2 veces reject
                            if (stderr) {
                                entro++;
                                console.log(stderr.cmd);
                                stderr.code = stderr.killed = stderr.signal = stderr.cmd = null;
                                reject(stderr);
                            }
                        }
                        if (entro == 0) {
                            //Evita hacer 2 veces reject
                            if (error) {
                                entro++;
                                console.log(error.cmd);
                                error.code = error.killed = error.signal = error.cmd = null;
                                reject(error);
                            }
                        }
                        try {
                            fs.unlinkSync(tmpXMLToSign);
                            //file removed
                        }
                        catch (err) { }
                        //console.log(`signedXML: ${stdout}`);
                        //resolve(Buffer.from(`${stdout}`,'utf8').toString());
                        //fs.writeFileSync(tmpXMLToSign + ".result.xml", `${stdout}`, {encoding: 'utf8'});
                        //let resultXML = fs.readFileSync(tmpXMLToSign + ".result.xml", {encoding: 'utf8'});
                        resolve(`${stdout}`);
                    });
                });
            }));
        });
    }
    /**
     * Firma con Java, varios documentos al mismo tiempo
     * @param xml
     * @param tag
     * @returns
     */
    signDocuments(xmls, tag, file, passphase) {
        return __awaiter(this, void 0, void 0, function* () {
            return new Promise((resolve, reject) => __awaiter(this, void 0, void 0, function* () {
                //console.log("A firmar", xml);
                find_java_home_1.default({ allowJre: true }, (err, java8Path) => {
                    java8Path += "/bin/java";
                    if (err)
                        return console.log(err);
                    //Comentar esta linea al llevar a Produccion, por que aqui trae java 6
                    if (process.env.java8_home) {
                        //java8Path = `"C:\\Program Files\\Java\\jdk1.8.0_221\\bin\\java"`;
                        java8Path = `${process.env.java8_home}`;
                    }
                    const classPath = "" + __dirname + "";
                    //const tmpXMLToSign = "" + __dirname + "/xml_sign_temp.xml";
                    const arrayNameFiles = new Array();
                    for (let i = 0; i < xmls.length; i++) {
                        const xml = xmls[i];
                        const tmpXMLToSign = "" +
                            __dirname +
                            "/xml_sign_temp_" +
                            Math.round(Math.random() * 999999) +
                            ".xml";
                        fs.writeFileSync(tmpXMLToSign, xml, { encoding: "utf8" });
                        arrayNameFiles.push(tmpXMLToSign);
                    }
                    exec(`"${java8Path}" -Dfile.encoding=IBM850 -classpath "${classPath}" SignXMLFiles "${arrayNameFiles.join(",")}" "${file}" "${passphase}" "${tag}"`, { encoding: "UTF-8" }, (error, stdout, stderr) => {
                        let stdOutProcesed = stdout;
                        /*console.log("error", error);
                        console.log("stdout", stdout);
                        console.log("stderr", stderr);
                        */
                        if (stdOutProcesed.includes("_SEPARATOR_")) {
                            //Por si haya algun log que quedo en la colita, entonces elimina ese
                            stdOutProcesed = stdout.substring(0, stdout.lastIndexOf("_SEPARATOR_") + 11);
                        }
                        let entro = 0;
                        if (entro == 0) {
                            if (stderr) {
                                if (!stdOutProcesed.includes("_SEPARATOR_")) {
                                    entro++;
                                    console.log(stderr.cmd);
                                    stderr.code =
                                        stderr.killed =
                                            stderr.signal =
                                                stderr.cmd =
                                                    null;
                                    reject(stderr);
                                }
                            }
                        }
                        if (entro == 0) {
                            if (error) {
                                if (!stdOutProcesed.includes("_SEPARATOR_")) {
                                    entro++;
                                    console.log(error.cmd);
                                    error.code = error.killed = error.signal = error.cmd = null;
                                    reject(error);
                                }
                            }
                        }
                        try {
                            for (let i = 0; i < arrayNameFiles.length; i++) {
                                const nameFile = arrayNameFiles[i];
                                fs.unlinkSync(nameFile);
                            }
                            //file removed
                        }
                        catch (err) {
                            console.error(err);
                        }
                        //console.log(`signedXML: ${stdout}`);
                        //resolve(Buffer.from(`${stdout}`,'utf8').toString());
                        //fs.writeFileSync(tmpXMLToSign + ".result.xml", `${stdout}`, {encoding: 'utf8'});
                        //let resultXML = fs.readFileSync(tmpXMLToSign + ".result.xml", {encoding: 'utf8'});
                        resolve(`${stdOutProcesed}`);
                    });
                });
            }));
        });
    }
    /**
     * Firma el XML del Evento con Java
     * @param xml
     * @param tag
     * @returns
     */
    signEvento(xml, tag, file, passphase) {
        return __awaiter(this, void 0, void 0, function* () {
            return new Promise((resolve, reject) => __awaiter(this, void 0, void 0, function* () {
                find_java_home_1.default({ allowJre: true }, (err, java8Path) => {
                    java8Path += "/bin/java";
                    if (err)
                        return console.log(err);
                    //Comentar esta linea al llevar a Produccion, por que aqui trae java 6
                    if (process.env.java8_home) {
                        //java8Path = `"C:\\Program Files\\Java\\jdk1.8.0_221\\bin\\java"`;
                        java8Path = `${process.env.java8_home}`;
                    }
                    const classPath = "" + __dirname + "";
                    const tmpXMLToSign = "" + __dirname + "/xml_sign_temp.xml";
                    fs.writeFileSync(tmpXMLToSign, xml, { encoding: "utf8" });
                    exec(`"${java8Path}" -Dfile.encoding=IBM850 -classpath "${classPath}" SignXMLEvento "${tmpXMLToSign}" "${file}" "${passphase}"`, { encoding: "UTF-8" }, (error, stdout, stderr) => {
                        if (error) {
                            reject(error);
                        }
                        if (stderr) {
                            reject(stderr);
                        }
                        try {
                            fs.unlinkSync(tmpXMLToSign);
                            //file removed
                        }
                        catch (err) {
                            console.error(err);
                        }
                        //console.log(`signedXML: ${stdout}`);
                        //resolve(Buffer.from(`${stdout}`,'utf8').toString());
                        //fs.writeFileSync(tmpXMLToSign + ".result.xml", `${stdout}`, {encoding: 'utf8'});
                        //let resultXML = fs.readFileSync(tmpXMLToSign + ".result.xml", {encoding: 'utf8'});
                        resolve(`${stdout}`);
                    });
                });
            }));
        });
    }
    /**
     * Firma con Java, retornando el documento firmado en el buffer de salida
     * @param xml
     * @param tag
     * @returns
     */
    getExpiration(file, passphase) {
        return __awaiter(this, void 0, void 0, function* () {
            return new Promise((resolve, reject) => __awaiter(this, void 0, void 0, function* () {
                find_java_home_1.default({ allowJre: true }, (err, java8Path) => {
                    java8Path += "/bin/java";
                    if (err)
                        return console.log(err);
                    //Comentar esta linea al llevar a Produccion, por que aqui trae java 6
                    if (process.env.java8_home) {
                        //java8Path = `"C:\\Program Files\\Java\\jdk1.8.0_221\\bin\\java"`;
                        java8Path = `${process.env.java8_home}`;
                    }
                    const classPath = "" + __dirname + "";
                    exec(`"${java8Path}" -Dfile.encoding=IBM850 -classpath "${classPath}" CertExpiration "${file}" "${passphase}"`, { encoding: "UTF-8" }, (error, stdout, stderr) => {
                        if (error) {
                            reject(new Error(error));
                        }
                        if (stderr) {
                            reject(new Error(stderr));
                        }
                        try {
                            //file removed
                        }
                        catch (err) {
                            console.error(err);
                        }
                        let respuestaJson = {};
                        if (stdout && (stdout + "").startsWith("{")) {
                            respuestaJson = JSON.parse(`${stdout}`);
                        }
                        resolve(respuestaJson);
                    });
                });
            }));
        });
    }
}
exports.default = new XMLDsig();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiWE1MRHNpZ0phdmEuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvWE1MRHNpZ0phdmEudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQSxvRUFBMEM7QUFFMUMsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUMxQyxJQUFJLEVBQUUsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFFdkIsTUFBTSxPQUFPO0lBQ1gsZ0JBQWUsQ0FBQztJQUVoQjs7Ozs7T0FLRztJQUNHLFlBQVksQ0FBQyxHQUFXLEVBQUUsR0FBUSxFQUFFLElBQVMsRUFBRSxTQUFjOztZQUNqRSxPQUFPLElBQUksT0FBTyxDQUFDLENBQU8sT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO2dCQUMzQyx3QkFBWSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsR0FBUSxFQUFFLFNBQWMsRUFBRSxFQUFFO29CQUM1RCxTQUFTLElBQUksV0FBVyxDQUFDO29CQUN6QixJQUFJLEdBQUc7d0JBQUUsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUVqQyxzRUFBc0U7b0JBQ3RFLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUU7d0JBQzFCLG1FQUFtRTt3QkFDbkUsU0FBUyxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQztxQkFDekM7b0JBRUQsTUFBTSxTQUFTLEdBQUcsRUFBRSxHQUFHLFNBQVMsR0FBRyxFQUFFLENBQUM7b0JBQ3RDLDZEQUE2RDtvQkFDN0QsTUFBTSxZQUFZLEdBQ2hCLEVBQUU7d0JBQ0YsU0FBUzt3QkFDVCxpQkFBaUI7d0JBQ2pCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLE1BQU0sQ0FBQzt3QkFDbEMsTUFBTSxDQUFDO29CQUVULEVBQUUsQ0FBQyxhQUFhLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO29CQUUxRCxJQUFJLENBQ0YsSUFBSSxTQUFTLHdDQUF3QyxTQUFTLGNBQWMsWUFBWSxNQUFNLElBQUksTUFBTSxTQUFTLE1BQU0sR0FBRyxHQUFHLEVBQzdILEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxFQUNyQixDQUFDLEtBQVUsRUFBRSxNQUFXLEVBQUUsTUFBVyxFQUFFLEVBQUU7d0JBQ3ZDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQzt3QkFDZCxJQUFJLEtBQUssSUFBSSxDQUFDLEVBQUU7NEJBQ2QsNEJBQTRCOzRCQUM1QixJQUFJLE1BQU0sRUFBRTtnQ0FDVixLQUFLLEVBQUUsQ0FBQztnQ0FFUixPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztnQ0FDeEIsTUFBTSxDQUFDLElBQUksR0FBRyxNQUFNLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUM7Z0NBRWhFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQzs2QkFDaEI7eUJBQ0Y7d0JBRUQsSUFBSSxLQUFLLElBQUksQ0FBQyxFQUFFOzRCQUNkLDRCQUE0Qjs0QkFDNUIsSUFBSSxLQUFLLEVBQUU7Z0NBQ1QsS0FBSyxFQUFFLENBQUM7Z0NBQ1IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7Z0NBQ3ZCLEtBQUssQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDO2dDQUU1RCxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7NkJBQ2Y7eUJBQ0Y7d0JBRUQsSUFBSTs0QkFDRixFQUFFLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDOzRCQUM1QixjQUFjO3lCQUNmO3dCQUFDLE9BQU8sR0FBRyxFQUFFLEdBQUU7d0JBRWhCLHNDQUFzQzt3QkFFdEMsc0RBQXNEO3dCQUN0RCxrRkFBa0Y7d0JBQ2xGLG9GQUFvRjt3QkFDcEYsT0FBTyxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsQ0FBQztvQkFDdkIsQ0FBQyxDQUNGLENBQUM7Z0JBQ0osQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDLENBQUEsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztLQUFBO0lBRUQ7Ozs7O09BS0c7SUFDRyxhQUFhLENBQUMsSUFBZ0IsRUFBRSxHQUFRLEVBQUUsSUFBUyxFQUFFLFNBQWM7O1lBQ3ZFLE9BQU8sSUFBSSxPQUFPLENBQUMsQ0FBTyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7Z0JBQzNDLCtCQUErQjtnQkFFL0Isd0JBQVksQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLEdBQVEsRUFBRSxTQUFjLEVBQUUsRUFBRTtvQkFDNUQsU0FBUyxJQUFJLFdBQVcsQ0FBQztvQkFDekIsSUFBSSxHQUFHO3dCQUFFLE9BQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFFakMsc0VBQXNFO29CQUN0RSxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFO3dCQUMxQixtRUFBbUU7d0JBQ25FLFNBQVMsR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLENBQUM7cUJBQ3pDO29CQUVELE1BQU0sU0FBUyxHQUFHLEVBQUUsR0FBRyxTQUFTLEdBQUcsRUFBRSxDQUFDO29CQUN0Qyw2REFBNkQ7b0JBQzdELE1BQU0sY0FBYyxHQUFHLElBQUksS0FBSyxFQUFFLENBQUM7b0JBRW5DLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO3dCQUNwQyxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBRXBCLE1BQU0sWUFBWSxHQUNoQixFQUFFOzRCQUNGLFNBQVM7NEJBQ1QsaUJBQWlCOzRCQUNqQixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxNQUFNLENBQUM7NEJBQ2xDLE1BQU0sQ0FBQzt3QkFFVCxFQUFFLENBQUMsYUFBYSxDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUUsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQzt3QkFFMUQsY0FBYyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztxQkFDbkM7b0JBRUQsSUFBSSxDQUNGLElBQUksU0FBUyx3Q0FBd0MsU0FBUyxtQkFBbUIsY0FBYyxDQUFDLElBQUksQ0FDbEcsR0FBRyxDQUNKLE1BQU0sSUFBSSxNQUFNLFNBQVMsTUFBTSxHQUFHLEdBQUcsRUFDdEMsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLEVBQ3JCLENBQUMsS0FBVSxFQUFFLE1BQVcsRUFBRSxNQUFXLEVBQUUsRUFBRTt3QkFDdkMsSUFBSSxjQUFjLEdBQUcsTUFBTSxDQUFDO3dCQUM1Qjs7OzBCQUdFO3dCQUNGLElBQUksY0FBYyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsRUFBRTs0QkFDMUMsb0VBQW9FOzRCQUNwRSxjQUFjLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FDL0IsQ0FBQyxFQUNELE1BQU0sQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLEdBQUcsRUFBRSxDQUN2QyxDQUFDO3lCQUNIO3dCQUNELElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQzt3QkFDZCxJQUFJLEtBQUssSUFBSSxDQUFDLEVBQUU7NEJBQ2QsSUFBSSxNQUFNLEVBQUU7Z0NBQ1YsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLEVBQUU7b0NBQzNDLEtBQUssRUFBRSxDQUFDO29DQUNSLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO29DQUN4QixNQUFNLENBQUMsSUFBSTt3Q0FDVCxNQUFNLENBQUMsTUFBTTs0Q0FDYixNQUFNLENBQUMsTUFBTTtnREFDYixNQUFNLENBQUMsR0FBRztvREFDUixJQUFJLENBQUM7b0NBRVQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2lDQUNoQjs2QkFDRjt5QkFDRjt3QkFDRCxJQUFJLEtBQUssSUFBSSxDQUFDLEVBQUU7NEJBQ2QsSUFBSSxLQUFLLEVBQUU7Z0NBQ1QsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLEVBQUU7b0NBQzNDLEtBQUssRUFBRSxDQUFDO29DQUNSLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29DQUN2QixLQUFLLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQztvQ0FFNUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO2lDQUNmOzZCQUNGO3lCQUNGO3dCQUVELElBQUk7NEJBQ0YsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLGNBQWMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0NBQzlDLE1BQU0sUUFBUSxHQUFHLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQ0FDbkMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQzs2QkFDekI7NEJBQ0QsY0FBYzt5QkFDZjt3QkFBQyxPQUFPLEdBQUcsRUFBRTs0QkFDWixPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO3lCQUNwQjt3QkFFRCxzQ0FBc0M7d0JBRXRDLHNEQUFzRDt3QkFDdEQsa0ZBQWtGO3dCQUNsRixvRkFBb0Y7d0JBQ3BGLE9BQU8sQ0FBQyxHQUFHLGNBQWMsRUFBRSxDQUFDLENBQUM7b0JBQy9CLENBQUMsQ0FDRixDQUFDO2dCQUNKLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUNMLENBQUM7S0FBQTtJQUVEOzs7OztPQUtHO0lBQ0csVUFBVSxDQUFDLEdBQVcsRUFBRSxHQUFRLEVBQUUsSUFBUyxFQUFFLFNBQWM7O1lBQy9ELE9BQU8sSUFBSSxPQUFPLENBQUMsQ0FBTyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7Z0JBQzNDLHdCQUFZLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxHQUFRLEVBQUUsU0FBYyxFQUFFLEVBQUU7b0JBQzVELFNBQVMsSUFBSSxXQUFXLENBQUM7b0JBQ3pCLElBQUksR0FBRzt3QkFBRSxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBRWpDLHNFQUFzRTtvQkFDdEUsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRTt3QkFDMUIsbUVBQW1FO3dCQUNuRSxTQUFTLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDO3FCQUN6QztvQkFFRCxNQUFNLFNBQVMsR0FBRyxFQUFFLEdBQUcsU0FBUyxHQUFHLEVBQUUsQ0FBQztvQkFDdEMsTUFBTSxZQUFZLEdBQUcsRUFBRSxHQUFHLFNBQVMsR0FBRyxvQkFBb0IsQ0FBQztvQkFFM0QsRUFBRSxDQUFDLGFBQWEsQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7b0JBRTFELElBQUksQ0FDRixJQUFJLFNBQVMsd0NBQXdDLFNBQVMsb0JBQW9CLFlBQVksTUFBTSxJQUFJLE1BQU0sU0FBUyxHQUFHLEVBQzFILEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxFQUNyQixDQUFDLEtBQVUsRUFBRSxNQUFXLEVBQUUsTUFBVyxFQUFFLEVBQUU7d0JBQ3ZDLElBQUksS0FBSyxFQUFFOzRCQUNULE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQzt5QkFDZjt3QkFDRCxJQUFJLE1BQU0sRUFBRTs0QkFDVixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7eUJBQ2hCO3dCQUVELElBQUk7NEJBQ0YsRUFBRSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQzs0QkFDNUIsY0FBYzt5QkFDZjt3QkFBQyxPQUFPLEdBQUcsRUFBRTs0QkFDWixPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO3lCQUNwQjt3QkFFRCxzQ0FBc0M7d0JBRXRDLHNEQUFzRDt3QkFDdEQsa0ZBQWtGO3dCQUNsRixvRkFBb0Y7d0JBQ3BGLE9BQU8sQ0FBQyxHQUFHLE1BQU0sRUFBRSxDQUFDLENBQUM7b0JBQ3ZCLENBQUMsQ0FDRixDQUFDO2dCQUNKLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUNMLENBQUM7S0FBQTtJQUVEOzs7OztPQUtHO0lBQ0csYUFBYSxDQUFDLElBQVMsRUFBRSxTQUFjOztZQUMzQyxPQUFPLElBQUksT0FBTyxDQUFDLENBQU8sT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO2dCQUMzQyx3QkFBWSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsR0FBUSxFQUFFLFNBQWMsRUFBRSxFQUFFO29CQUM1RCxTQUFTLElBQUksV0FBVyxDQUFDO29CQUN6QixJQUFJLEdBQUc7d0JBQUUsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUVqQyxzRUFBc0U7b0JBQ3RFLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUU7d0JBQzFCLG1FQUFtRTt3QkFDbkUsU0FBUyxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQztxQkFDekM7b0JBRUQsTUFBTSxTQUFTLEdBQUcsRUFBRSxHQUFHLFNBQVMsR0FBRyxFQUFFLENBQUM7b0JBRXRDLElBQUksQ0FDRixJQUFJLFNBQVMsd0NBQXdDLFNBQVMscUJBQXFCLElBQUksTUFBTSxTQUFTLEdBQUcsRUFDekcsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLEVBQ3JCLENBQUMsS0FBVSxFQUFFLE1BQVcsRUFBRSxNQUFXLEVBQUUsRUFBRTt3QkFDdkMsSUFBSSxLQUFLLEVBQUU7NEJBQ1QsTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7eUJBQzFCO3dCQUNELElBQUksTUFBTSxFQUFFOzRCQUNWLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO3lCQUMzQjt3QkFFRCxJQUFJOzRCQUNGLGNBQWM7eUJBQ2Y7d0JBQUMsT0FBTyxHQUFHLEVBQUU7NEJBQ1osT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQzt5QkFDcEI7d0JBRUQsSUFBSSxhQUFhLEdBQUcsRUFBRSxDQUFDO3dCQUN2QixJQUFJLE1BQU0sSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUU7NEJBQzNDLGFBQWEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsQ0FBQzt5QkFDekM7d0JBQ0QsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO29CQUN6QixDQUFDLENBQ0YsQ0FBQztnQkFDSixDQUFDLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQSxDQUFDLENBQUM7UUFDTCxDQUFDO0tBQUE7Q0FDRjtBQUVELGtCQUFlLElBQUksT0FBTyxFQUFFLENBQUMifQ==